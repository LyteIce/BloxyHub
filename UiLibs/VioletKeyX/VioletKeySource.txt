local VioletKey = {}

function VioletKey:CreateKeyWindow(options)
    options = options or {}
    local Title = options.Title or "Violet Keys"
    local Description = options.Description or "Key system Made by Waffley"
    local GetKeyText = options.GetKeyText or "You can get the key from our Discord"
    local GetKeyLink = options.GetKeyLink or "https://discord.gg/example"
    local CorrectKey = options.CorrectKey or ""
    local OnSuccess = options.OnSuccess or function() warn("Key accepted - no success callback provided") end

    local Player = game.Players.LocalPlayer
    local PlayerGui = Player:WaitForChild("PlayerGui")

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "VioletKeySystem"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = PlayerGui

    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Position = UDim2.new(0.332, 0, 0.287, 0)
    Main.Size = UDim2.new(0, 440, 0, 283)
    Main.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    Main.BorderSizePixel = 0
    Main.Parent = ScreenGui

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 30)
    UICorner.Parent = Main

    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.new(1, 1, 1)
    UIStroke.Thickness = 2
    UIStroke.Parent = Main

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "Title"
    TitleLabel.Position = UDim2.new(0.061, 0, -0.085, 0)
    TitleLabel.Size = UDim2.new(0, 390, 0, 24)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = Title
    TitleLabel.TextColor3 = Color3.new(1, 1, 1)
    TitleLabel.TextSize = 24
    TitleLabel.Font = Enum.Font.SourceSansBold
    TitleLabel.Parent = Main

    local KeyBox = Instance.new("TextBox")
    KeyBox.Name = "KeyBox"
    KeyBox.Position = UDim2.new(0.298, 0, 0.240, 0)
    KeyBox.Size = UDim2.new(0, 177, 0, 38)
    KeyBox.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
    KeyBox.BackgroundTransparency = 0.25
    KeyBox.BorderSizePixel = 0
    KeyBox.Text = ""
    KeyBox.PlaceholderText = "Enter Key"
    KeyBox.PlaceholderColor3 = Color3.fromRGB(118, 26, 90)
    KeyBox.TextColor3 = Color3.new(1, 1, 1)
    KeyBox.TextSize = 18
    KeyBox.Font = Enum.Font.SourceSansBold
    KeyBox.Parent = Main

    local UICorner3 = Instance.new("UICorner")
    UICorner3.CornerRadius = UDim.new(0, 12)
    UICorner3.Parent = KeyBox

    local Enter = Instance.new("TextButton")
    Enter.Name = "Enter"
    Enter.Position = UDim2.new(0.445, 0, 0.456, 0)
    Enter.Size = UDim2.new(0, 48, 0, 24)
    Enter.BackgroundColor3 = Color3.fromRGB(71, 0, 0)
    Enter.BackgroundTransparency = 0.43
    Enter.BorderSizePixel = 0
    Enter.Text = "Enter"
    Enter.TextColor3 = Color3.new(1, 1, 1)
    Enter.TextSize = 18
    Enter.Font = Enum.Font.SourceSansBold
    Enter.Parent = Main

    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 12)
    UICorner2.Parent = Enter

    local Desc = Instance.new("TextLabel")
    Desc.Name = "Desc"
    Desc.Position = UDim2.new(0.027, 0, 0.643, 0)
    Desc.Size = UDim2.new(0, 148, 0, 81)
    Desc.BackgroundTransparency = 1
    Desc.Text = "Description: " .. Description
    Desc.TextColor3 = Color3.new(1, 1, 1)
    Desc.TextSize = 16
    Desc.Font = Enum.Font.SourceSansBold
    Desc.TextWrapped = true
    Desc.TextXAlignment = Enum.TextXAlignment.Left
    Desc.TextYAlignment = Enum.TextYAlignment.Top
    Desc.Parent = Main

    local GetKey = Instance.new("TextButton")
    GetKey.Name = "GetKey"
    GetKey.Position = UDim2.new(0.693, 0, 0.597, 0)
    GetKey.Size = UDim2.new(0, 200, 0, 35)
    GetKey.BackgroundTransparency = 1
    GetKey.Text = GetKeyText
    GetKey.TextColor3 = Color3.fromRGB(100, 150, 255)
    GetKey.TextSize = 16
    GetKey.Font = Enum.Font.SourceSansBold
    GetKey.TextWrapped = true
    GetKey.TextXAlignment = Enum.TextXAlignment.Left
    GetKey.Parent = Main

    -- Make GetKey look like a link (underline + hover effect)
    local GetKeyStroke = Instance.new("UIStroke")
    GetKeyStroke.Thickness = 1
    GetKeyStroke.Color = Color3.fromRGB(100, 150, 255)
    GetKeyStroke.Parent = GetKey

    GetKey.MouseEnter:Connect(function()
        GetKey.TextColor3 = Color3.fromRGB(150, 200, 255)
    end)
    GetKey.MouseLeave:Connect(function()
        GetKey.TextColor3 = Color3.fromRGB(100, 150, 255)
    end)

    GetKey.MouseButton1Click:Connect(function()
        setclipboard(GetKeyLink)
        -- Optional: show a quick notification that link was copied
    end)

    -- Draggable functionality
    local dragging = false
    local dragInput
    local dragStart
    local startPos

    Main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    Main.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    -- Enter button logic
    Enter.MouseButton1Click:Connect(function()
        local enteredKey = KeyBox.Text
        if enteredKey == CorrectKey then
            ScreenGui:Destroy()
            OnSuccess()
        else
            KeyBox.Text = ""
            -- Simple wrong key feedback
            KeyBox.PlaceholderText = "Wrong Key!"
            task.wait(2)
            KeyBox.PlaceholderText = "Enter Key"
        end
    end)

    -- Allow pressing Enter key in the TextBox
    KeyBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            Enter:Activate()
        end
    end)
end

return VioletKey
